<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="TihBlogCompact._Default" MasterPageFile="~/main.Master" %>
<%@ Register Assembly="RssToolkit, Version=1.0.0.1, Culture=neutral, PublicKeyToken=02e47a85b237026a" Namespace="RssToolkit" TagPrefix="cc1" %>
    
<asp:Content ID="_mainContent" ContentPlaceHolderID="_mainContentPlaceHolder" runat="server">
    <asp:UpdatePanel ID="_articlesUP" runat="server">
     <ContentTemplate>
       <asp:PlaceHolder ID="_selectedFilterPH" runat="server"></asp:PlaceHolder>
       <asp:GridView ID="_ArticlesGV" runat="server" DataSourceID="_topArticlesDS" PageSize="3" AllowPaging="true" 
        AutoGenerateColumns="false" AutoGenerateEditButton="false" AutoGenerateDeleteButton="false"
            SkinID="NoneGridSkin" Width="100%" GridLines="none" OnInit="_ArticlesGV_Init" CssClass="margin_t_0">
         <Columns>
          <asp:TemplateField>
           <ItemTemplate>
            <div style="text-align:center">
              <a class="article_title" href='article.aspx?articleId=<%# DataBinder.Eval(Container.DataItem, "ID") %>' ><b><%# DataBinder.Eval(Container.DataItem, "title")%></b></a>
            </div>
            <div style="margin-top: 5px;">
              <b><%= Resources.Resources.PostedBy %>&nbsp;<%# DataBinder.Eval(Container.DataItem, "publisher") %>&nbsp;<%= Resources.Resources.On %>&nbsp;<%# DataBinder.Eval(Container.DataItem, "published", "{0:dd MMMM yyyy HH:mm}")%></b></div>
            <div>
              <%# PostedIn(DataBinder.Eval(Container.DataItem, "ID")) %>
            </div>
            <div style="height: 210px; overflow: hidden; padding-left: 3px; ">
              <%# DataBinder.Eval(Container.DataItem, "content") %>
            </div>
            <div class="article_footer">
             <asp:Panel ID="_commentsOnPanel" runat="server" Visible='<%# AllowComments(DataBinder.Eval(Container.DataItem, "allowComments")) %>'>
                &nbsp;<a href='Article.aspx?articleId=<%# DataBinder.Eval(Container.DataItem, "ID") %>&comments=true' class="article_link"><%= Resources.Resources.Comments %>(<%# GetCommentsCount(DataBinder.Eval(Container.DataItem, "ID")) %>)</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<cc1:rsshyperlink id="_rssHL" runat="server" includeusername="False" CssClass="subMenu_link" navigateurl="~/rssComments.ashx" ChannelName='<%# GetRssCommentsChannelName(DataBinder.Eval(Container.DataItem, "ID")) %>' OnLoad="_rssHL_Load">Post RSS<asp:Image ID="_rssImage" runat="server" AlternateText="Subscribe to RSS Feed" ImageUrl="~/images/rssBtn.gif" /></cc1:rsshyperlink><asp:Label ID="_hiddenArticleId" runat="server" Visible="false" Text='<%# DataBinder.Eval(Container.DataItem, "ID") %>'></asp:Label>                
             </asp:Panel>
             <asp:Panel ID="_commentsOffPanel" runat="server" Visible='<%# !AllowComments(DataBinder.Eval(Container.DataItem, "allowComments")) %>'>
               <%= Resources.Resources.CommentsAreOff %>
             </asp:Panel>
            </div>
           </ItemTemplate>
          </asp:TemplateField>
         </Columns>
       </asp:GridView>
     </ContentTemplate>
    </asp:UpdatePanel>
    <tasp:TBAccessDataSource ID="_topArticlesDS" runat="server"
             SelectCommand="SELECT A.[ID] as ID,
                                   A.[authorId] as authorId, 
                                   A.[published] as published, 
                                   A.[allowComments] as allowComments, 
                                   A.[title] as title, 
                                   A.[content] as content,
                                   P.[names] as publisher
                            FROM [Articles] A, [Authors] P
                            WHERE A.[authorId] = P.[ID]
                            ORDER BY [published] DESC">
    </tasp:TBAccessDataSource>
</asp:Content>